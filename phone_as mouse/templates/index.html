<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gyro Phone Mouse v2</title>
    <style>
        body {
            margin: 0;
            width: 100vw;
            height: 100vh;
            background: #f7f5f5;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            touch-action: none;
            font-family: Arial, sans-serif;
        }
        
        .control-panel {
            position: absolute;
            top: 50px;
            /* Move buttons to the top */
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            display: flex;
            justify-content: space-between;
            /* Align buttons side by side */
        }
        
        .button {
            flex: 1;
            /* Make buttons equal width */
            padding: 15px;
            margin: 5px;
            background: #f0eaea;
            text-align: center;
            border-radius: 15px;
            -webkit-user-select: none;
            user-select: none;
            transition: background 0.2s;
        }
        
        .button:active {
            background: #606060;
        }
    </style>
</head>

<body>
    <div class="status" id="connectionStatus">Disconnected</div>
    <div class="control-panel">
        <button class="button" id="leftClick">Left Click</button>
        <button class="button" id="rightClick">Right Click</button>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const serverIP = " 172.25.147.157"; // Update with your server IP
        const socket = io(`http://${serverIP}:5000`, {
            transports: ["websocket"],
            reconnection: true,
            reconnectionAttempts: 5,
            reconnectionDelay: 1000,
        });

        // Sensitivity settings
        const MOUSE_SENSITIVITY = 2.0; // Adjust this for cursor speed
        const DOUBLE_TAP_SENSITIVITY = 1.2; // Adjust position mapping accuracy

        // Connection status handling
        socket.on("connect", () => updateStatus("Connected", "#4CAF50"));
        socket.on("disconnect", () => updateStatus("Disconnected", "#f44336"));
        socket.on("connect_error", () => updateStatus("Connection Failed", "#ff9800"));

        function updateStatus(text, color) {
            const statusElem = document.getElementById("connectionStatus");
            statusElem.textContent = text;
            statusElem.style.backgroundColor = color;
        }

        // Click Events
        document.getElementById("leftClick").addEventListener("touchstart", (e) => {
            e.preventDefault();
            socket.emit("leftclick");
        });

        document.getElementById("rightClick").addEventListener("touchstart", (e) => {
            e.preventDefault();
            socket.emit("rightclick");
        });

        // Touch handling with sensitivity adjustment
        let touchStartX = 0,
            touchStartY = 0;

        document.body.addEventListener("touchstart", (e) => {
            if (e.touches.length === 1) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }
        });

        document.body.addEventListener("touchmove", (e) => {
            if (e.touches.length === 1) {
                e.preventDefault();
                const dx = (e.touches[0].clientX - touchStartX) * MOUSE_SENSITIVITY;
                const dy = (e.touches[0].clientY - touchStartY) * MOUSE_SENSITIVITY;
                socket.emit("mousemove", {
                    dx,
                    dy
                });
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }
        });

        // Improved Double Tap Detection
        let lastTap = 0;
        document.body.addEventListener("touchstart", (e) => {
            let currentTime = new Date().getTime();
            let tapLength = currentTime - lastTap;

            if (tapLength < 300 && tapLength > 0) { // Detect double-tap
                e.preventDefault();

                console.log("Double-tap detected. Sending double-click event.");
                socket.emit("doubleclick_position", {}); // No need to send x,y
            }

            lastTap = currentTime;
        });
    </script>
</body>

</html>